# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–Ø –Ω–µ –º–æ–≥—É –Ω–∞–ø—Ä—è–º—É—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Google, Yandex –∏ VK, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º. –ù–æ —è —Å–æ–∑–¥–∞–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /var/www/xk-media-backend
source venv/bin/activate
python scripts/check_oauth_config.py
```

### –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω: https://xk-media.ru/admin
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **OAuth –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
3. –ù–∞–∂–º–∏—Ç–µ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å OAuth**
4. –í—ã —É–≤–∏–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ redirect URIs

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é

### 1. Google OAuth

**–®–∞–≥–∏:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://console.cloud.google.com/
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **APIs & Services** ‚Üí **Credentials**
4. –ù–∞–∂–º–∏—Ç–µ **+ CREATE CREDENTIALS** ‚Üí **OAuth client ID**
5. –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ OAuth consent screen:
   - User Type: **External**
   - App name: **XK Media**
   - User support email: –≤–∞—à email
   - Developer contact: –≤–∞—à email
   - –ù–∞–∂–º–∏—Ç–µ **Save and Continue**
   - Scopes: –æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, **Save and Continue**
   - Test users: –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à email, **Save and Continue**
   - –ù–∞–∂–º–∏—Ç–µ **Back to Dashboard**
6. –°–æ–∑–¥–∞–π—Ç–µ OAuth Client ID:
   - Application type: **Web application**
   - Name: **XK Media Web Client**
   - Authorized redirect URIs: –¥–æ–±–∞–≤—å—Ç–µ:
     ```
     https://xk-media.ru/auth/oauth/google/callback
     http://109.69.21.98/auth/oauth/google/callback
     ```
   - –ù–∞–∂–º–∏—Ç–µ **Create**
7. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID** –∏ **Client secret**
8. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   nano /var/www/xk-media-backend/.env
   ```
   –î–æ–±–∞–≤—å—Ç–µ:
   ```
   GOOGLE_CLIENT_ID=–≤–∞—à_client_id
   GOOGLE_CLIENT_SECRET=–≤–∞—à_client_secret
   ```
9. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   systemctl restart xk-media
   ```

### 2. Yandex OAuth

**–®–∞–≥–∏:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://oauth.yandex.ru/
2. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: **XK Media**
   - –û–ø–∏—Å–∞–Ω–∏–µ: **–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ä–µ–∫–ª–∞–º—ã**
   - –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: –≤—ã–±–µ—Ä–∏—Ç–µ **–í–µ–±-—Å–µ—Ä–≤–∏—Å—ã**
   - Redirect URI: `https://xk-media.ru/auth/oauth/yandex/callback`
   - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: –æ—Ç–º–µ—Ç—å—Ç–µ **–î–æ—Å—Ç—É–ø –∫ email –∞–¥—Ä–µ—Å—É**
4. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –∏ **–ü–∞—Ä–æ–ª—å**
6. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```
   YANDEX_CLIENT_ID=–≤–∞—à_id_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   YANDEX_CLIENT_SECRET=–≤–∞—à_–ø–∞—Ä–æ–ª—å
   ```
7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   systemctl restart xk-media
   ```

### 3. VK OAuth

**–®–∞–≥–∏:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://dev.vk.com/
2. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: **XK Media**
   - –¢–∏–ø: **–í–µ–±-—Å–∞–π—Ç**
   - –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
5. –í —Ä–∞–∑–¥–µ–ª–µ **–ë–∞–∑–æ–≤—ã–µ**:
   - –ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞: `https://xk-media.ru`
   - –ë–∞–∑–æ–≤—ã–π –¥–æ–º–µ–Ω: `xk-media.ru`
6. –í —Ä–∞–∑–¥–µ–ª–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **OAuth**:
   - Redirect URI: `https://xk-media.ru/auth/oauth/vk/callback`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
7. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –∏ **–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –∫–ª—é—á**
8. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```
   VK_CLIENT_ID=–≤–∞—à_id_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   VK_CLIENT_SECRET=–≤–∞—à_–∑–∞—â–∏—â–µ–Ω–Ω—ã–π_–∫–ª—é—á
   ```
9. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   systemctl restart xk-media
   ```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   ```bash
   python scripts/check_oauth_config.py
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
   - https://xk-media.ru/admin/settings
   - –ù–∞–∂–º–∏—Ç–µ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å OAuth**

3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:
   - https://xk-media.ru/login
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

## üîß –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Google –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–ø—Ä–µ—â–µ–Ω –¥–æ—Å—Ç—É–ø"

**–ü—Ä–∏—á–∏–Ω–∞:** Redirect URI –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ redirect URI —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (–≤–∫–ª—é—á–∞—è http/https)
2. –í Google Cloud Console ‚Üí **OAuth consent screen**:
   - –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ç–∞—Ç—É—Å–µ "Testing", –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ò–ª–∏ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Publish App)

### Yandex/VK –≤—ã–¥–∞—é—Ç –æ—à–∏–±–∫—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π redirect URI –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ redirect URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URI —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, —á—Ç–æ –≤ –∫–æ–¥–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```bash
   journalctl -u xk-media -f
   ```

## üìù –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è .env

```bash
cd /var/www/xk-media-backend
nano .env
# –î–æ–±–∞–≤—å—Ç–µ/–∏–∑–º–µ–Ω–∏—Ç–µ:
# GOOGLE_CLIENT_ID=...
# GOOGLE_CLIENT_SECRET=...
# YANDEX_CLIENT_ID=...
# YANDEX_CLIENT_SECRET=...
# VK_CLIENT_ID=...
# VK_CLIENT_SECRET=...
# BASE_URL=https://xk-media.ru

systemctl restart xk-media
```

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö —Ç—Ä–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ OAuth –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. üéâ
