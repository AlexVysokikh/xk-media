{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî XK Media{% endblock %}

{% block head %}
<style>
    .filter-bar {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
    }
    .filter-row {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    .filter-group label {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    .filter-group input, .filter-group select {
        padding: 0.5rem 0.75rem;
        background: var(--secondary);
        border: 1px solid var(--border);
        border-radius: 6px;
        color: var(--text);
        font-size: 0.875rem;
    }
    .period-buttons {
        display: flex;
        gap: 0.25rem;
    }
    .period-btn {
        padding: 0.5rem 0.75rem;
        background: var(--secondary);
        border: 1px solid var(--border);
        border-radius: 6px;
        color: var(--text-muted);
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    .period-btn:hover, .period-btn.active {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    .stat-box {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
    }
    .stat-box .value {
        font-size: 1.75rem;
        font-weight: 700;
    }
    .stat-box .label {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }
    .tv-stats-card {
        background: var(--secondary);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr auto;
        gap: 1rem;
        align-items: center;
    }
    .tv-stats-card:hover {
        background: var(--border);
    }
    .tv-info .name {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    .tv-info .venue {
        font-size: 0.8rem;
        color: var(--text-muted);
    }
    .tv-info .location {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    .stat-cell {
        text-align: center;
    }
    .stat-cell .num {
        font-size: 1.25rem;
        font-weight: 700;
    }
    .stat-cell .desc {
        font-size: 0.7rem;
        color: var(--text-muted);
    }
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .tv-stats-card {
            grid-template-columns: 1fr;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block logo %}
<a href="/advertiser" class="logo">
    <span class="logo-icon">üì∫</span>
    XK Media
</a>
{% endblock %}

{% block nav %}
<a href="/advertiser">–î–∞—à–±–æ—Ä–¥</a>
<a href="/advertiser/stats" class="active">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
<a href="/advertiser/subscriptions">–ü–æ–¥–ø–∏—Å–∫–∏</a>
<a href="/advertiser/payments">–ü–ª–∞—Ç–µ–∂–∏</a>
<a href="/advertiser/profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
<a href="/logout" class="btn btn-secondary btn-sm">–í—ã–π—Ç–∏</a>
{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem;">
    <div>
        <h1 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã</h1>
        <p class="page-subtitle">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –≤–∞—à–∏–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è–º</p>
    </div>
    <div style="display: flex; gap: 0.5rem;">
        <a href="/advertiser/export/csv" class="btn btn-secondary btn-sm">üì• CSV</a>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filter-bar">
    <form method="GET" action="/advertiser/stats" class="filter-row">
        <div class="filter-group">
            <label>–ü–µ—Ä–∏–æ–¥</label>
            <div class="period-buttons">
                <a href="/advertiser/stats?period=today" class="period-btn {% if period == 'today' %}active{% endif %}">–°–µ–≥–æ–¥–Ω—è</a>
                <a href="/advertiser/stats?period=week" class="period-btn {% if period == 'week' %}active{% endif %}">7 –¥–Ω–µ–π</a>
                <a href="/advertiser/stats?period=month" class="period-btn {% if period == 'month' %}active{% endif %}">30 –¥–Ω–µ–π</a>
                <a href="/advertiser/stats" class="period-btn {% if not period %}active{% endif %}">–í—Å—ë –≤—Ä–µ–º—è</a>
            </div>
        </div>
        <div class="filter-group">
            <label>–° –¥–∞—Ç—ã</label>
            <input type="date" name="date_from" value="{{ date_from }}">
        </div>
        <div class="filter-group">
            <label>–ü–æ –¥–∞—Ç—É</label>
            <input type="date" name="date_to" value="{{ date_to }}">
        </div>
        <div class="filter-group">
            <label>–¢–í-—ç–∫—Ä–∞–Ω</label>
            <select name="tv_id">
                <option value="">–í—Å–µ —ç–∫—Ä–∞–Ω—ã</option>
                {% for c in all_campaigns %}
                <option value="{{ c.tv_id }}" {% if selected_tv_id == c.tv_id %}selected{% endif %}>{{ c.tv.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-box">
        <div class="value" style="color: var(--accent);">{{ stats.impressions }}</div>
        <div class="label">–ü–æ–∫–∞–∑–æ–≤</div>
    </div>
    <div class="stat-box">
        <div class="value" style="color: var(--success);">{{ stats.clicks }}</div>
        <div class="label">–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ (CPC)</div>
    </div>
    <div class="stat-box">
        <div class="value" style="color: #6495ed;">{{ stats.active_count }}</div>
        <div class="label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¢–í</div>
    </div>
    <div class="stat-box">
        <div class="value" style="color: #ffd700;">{{ stats.conversion }}%</div>
        <div class="label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
    </div>
</div>

<!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¢–í -->
<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h3 class="card-title">üì∫ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¢–í-—ç–∫—Ä–∞–Ω–∞–º</h3>
        <span style="font-size: 0.8rem; color: var(--text-muted);">{{ campaigns|length }} —Ä–∞–∑–º–µ—â–µ–Ω–∏–π</span>
    </div>
    
    {% if campaigns %}
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã -->
    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 1rem; padding: 0.75rem 1rem; background: var(--secondary); border-radius: 8px; margin-bottom: 0.5rem; font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">
        <div>–¢–í / –ú–µ—Å—Ç–æ</div>
        <div style="text-align: center;">–ü–æ–∫–∞–∑—ã</div>
        <div style="text-align: center;">–ü–µ—Ä–µ—Ö–æ–¥—ã</div>
        <div style="text-align: center;">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
        <div style="text-align: center; width: 70px;">–°—Ç–∞—Ç—É—Å</div>
    </div>
    
    {% for c in campaigns %}
    <div class="tv-stats-card">
        <div class="tv-info">
            <div class="name">{{ c.tv.name }}</div>
            <div class="venue">üìç {{ c.tv.venue_name or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}</div>
            <div class="location">
                {% if c.tv.city %}{{ c.tv.city }}, {% endif %}{{ c.tv.address or '' }}
            </div>
            <div style="font-size: 0.75rem; color: var(--accent); margin-top: 0.25rem;">
                {{ c.title }} ‚Üí <a href="{{ c.url }}" target="_blank" style="font-size: 0.7rem;">{{ c.url[:35] }}...</a>
            </div>
        </div>
        <div class="stat-cell">
            <div class="num" style="color: var(--accent);">{{ c.impressions or 0 }}</div>
            <div class="desc">–ø–æ–∫–∞–∑–æ–≤</div>
        </div>
        <div class="stat-cell">
            <div class="num" style="color: var(--success);">{{ c.clicks or 0 }}</div>
            <div class="desc">–ø–µ—Ä–µ—Ö–æ–¥–æ–≤</div>
        </div>
        <div class="stat-cell">
            <div class="num">
                {% if c.impressions and c.impressions > 0 %}
                {{ "%.2f"|format((c.clicks or 0) / c.impressions * 100) }}%
                {% else %}
                0%
                {% endif %}
            </div>
            <div class="desc">–∫–æ–Ω–≤–µ—Ä—Å–∏—è</div>
        </div>
        <div style="text-align: center; width: 70px;">
            {% if c.is_active %}
            <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–∞</span>
            {% else %}
            <span class="badge badge-danger">–°—Ç–æ–ø</span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    
    <!-- –ò—Ç–æ–≥–æ -->
    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 1rem; padding: 1rem; background: linear-gradient(135deg, var(--accent), #ff6b6b); border-radius: 8px; margin-top: 0.5rem; color: white;">
        <div style="font-weight: 700;">–ò–¢–û–ì–û:</div>
        <div style="text-align: center; font-weight: 700; font-size: 1.25rem;">{{ stats.impressions }}</div>
        <div style="text-align: center; font-weight: 700; font-size: 1.25rem;">{{ stats.clicks }}</div>
        <div style="text-align: center; font-weight: 700;">{{ stats.conversion }}%</div>
        <div style="width: 70px;"></div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
        <p style="font-size: 1.25rem; margin-bottom: 0.5rem;">üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
        <p style="font-size: 0.9rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–∑–º–µ—â–µ–Ω–∏–π –Ω–∞ –¢–í-—ç–∫—Ä–∞–Ω–∞—Ö</p>
        <a href="/advertiser/subscriptions" class="btn btn-primary" style="margin-top: 1rem;">–û—Ñ–æ—Ä–º–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ</a>
    </div>
    {% endif %}
</div>

<!-- –ü–æ—è—Å–Ω–µ–Ω–∏—è -->
<div class="card" style="margin-top: 1.5rem; background: var(--secondary);">
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem;">
        <div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">üì∫ –ü–æ–∫–∞–∑—ã</div>
            <p style="font-size: 0.85rem; color: var(--text-muted);">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ –¢–í</p>
        </div>
        <div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">üñ±Ô∏è –ü–µ—Ä–µ—Ö–æ–¥—ã (CPC)</div>
            <p style="font-size: 0.85rem; color: var(--text-muted);">–ö–ª–∏–∫–∏ –Ω–∞ –≤–∞—à—É —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ NFC –Ω–∞ –¢–í</p>
        </div>
        <div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">üìä –ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
            <p style="font-size: 0.85rem; color: var(--text-muted);">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–æ–∫–∞–∑–æ–≤</p>
        </div>
    </div>
</div>
{% endblock %}
