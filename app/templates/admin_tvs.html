{% extends "base.html" %}

{% block title %}–¢–í-—ç–∫—Ä–∞–Ω—ã ‚Äî –ê–¥–º–∏–Ω{% endblock %}

{% block logo %}
<a href="/admin" class="logo">
    <span class="logo-icon">üì∫</span>
    XK Media
</a>
{% endblock %}

{% block nav %}
<a href="/admin">–î–∞—à–±–æ—Ä–¥</a>
<a href="/admin/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
<a href="/admin/tvs" class="active">–≠–∫—Ä–∞–Ω—ã</a>
<a href="/admin/payments">–ü–ª–∞—Ç–µ–∂–∏</a>
<a href="/admin/payouts">–í—ã–ø–ª–∞—Ç—ã</a>
<a href="/admin/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
<a href="/logout" class="btn btn-secondary btn-sm">–í—ã–π—Ç–∏</a>
{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h1 class="page-title">üì∫ –¢–í-—ç–∫—Ä–∞–Ω—ã</h1>
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ digital-—Ç–æ—á–∫–∞–º–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</p>
    </div>
    <button onclick="document.getElementById('addTvModal').style.display='flex'" class="btn btn-primary">
        + –î–æ–±–∞–≤–∏—Ç—å –¢–í
    </button>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="grid grid-3" style="margin-bottom: 1.5rem;">
    <div class="card stat-card">
        <div class="stat-value">{{ tvs|length }}</div>
        <div class="stat-label">–í—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–æ–≤</div>
    </div>
    <div class="card stat-card">
        <div class="stat-value">{{ tvs|selectattr('is_active')|list|length }}</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
    </div>
    <div class="card stat-card">
        <div class="stat-value">{{ tvs|rejectattr('is_active')|list|length }}</div>
        <div class="stat-label">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –¢–í -->
<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>–ö–æ–¥</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ / –ú–µ—Å—Ç–æ</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–ê–¥—Ä–µ—Å</th>
                <th>–Æ—Ä. –ª–∏—Ü–æ</th>
                <th>–°—Å—ã–ª–∫–∏</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for tv in tvs %}
            <tr>
                <td>
                    <code style="background: var(--secondary); padding: 0.25rem 0.5rem; border-radius: 4px;">{{ tv.code }}</code>
                </td>
                <td>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        {% if tv.photo_url %}
                        <img src="{{ tv.photo_url }}" alt="{{ tv.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; border: 1px solid var(--border);">
                        {% endif %}
                        <div>
                            <div style="font-weight: 600;">{{ tv.name }}</div>
                            {% if tv.venue_name %}
                            <div style="font-size: 0.875rem; color: var(--text-muted);">{{ tv.venue_name }}</div>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge badge-info">{{ categories.get(tv.category, tv.category) }}</span>
                </td>
                <td style="max-width: 200px;">
                    <div style="font-size: 0.875rem;">{{ tv.city or '' }}</div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">{{ tv.address or '‚Äî' }}</div>
                </td>
                <td style="font-size: 0.875rem;">
                    {% if tv.legal_name %}
                    <div>{{ tv.legal_name }}</div>
                    <div style="color: var(--text-muted);">–ò–ù–ù: {{ tv.inn or '‚Äî' }}</div>
                    {% else %}
                    <span style="color: var(--text-muted);">‚Äî</span>
                    {% endif %}
                </td>
                <td style="text-align: center;">
                    <span style="font-weight: 600;">{{ tv.links_count }}</span>
                </td>
                <td>
                    {% if tv.is_active %}
                    <span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% else %}
                    <span class="badge badge-danger">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="/admin/tv/{{ tv.code }}" class="btn btn-secondary btn-sm">–û—Ç–∫—Ä—ã—Ç—å</a>
                        <a href="/admin/tv/{{ tv.code }}/delete" class="btn btn-secondary btn-sm" 
                           style="color: var(--accent);"
                           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –¢–í ¬´{{ tv.name }}¬ª? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                            üóë
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
            {% if not tvs %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 3rem; color: var(--text-muted);">
                    –¢–í-—ç–∫—Ä–∞–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. <a href="#" onclick="document.getElementById('addTvModal').style.display='flex'">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π</a>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¢–í -->
<div id="addTvModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 2rem;">
    <div class="card" style="max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto;">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 class="card-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¢–í</h3>
            <button onclick="document.getElementById('addTvModal').style.display='none'" 
                    style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">
                √ó
            </button>
        </div>
        
        <form method="POST" action="/admin/tvs/add" enctype="multipart/form-data">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–µ -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–û–°–ù–û–í–ù–û–ï</h4>
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">–ö–æ–¥ –¢–í *</label>
                    <input type="text" name="code" class="form-input" placeholder="tv001" required pattern="[a-zA-Z0-9_-]+">
                    <small style="color: var(--text-muted);">–õ–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤</small>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–í *</label>
                    <input type="text" name="name" class="form-input" placeholder="–¢–í #1 —É –≤—Ö–æ–¥–∞" required>
                </div>
            </div>
            
            <!-- –ú–µ—Å—Ç–æ -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–ú–ï–°–¢–û –†–ê–ó–ú–ï–©–ï–ù–ò–Ø</h4>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</label>
                <input type="text" name="venue_name" class="form-input" placeholder="–ö–æ—Ñ–µ–π–Ω—è ¬´–†–∞—Å—Å–≤–µ—Ç¬ª">
            </div>
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select name="category" class="form-input">
                        {% for key, val in categories.items() %}
                        <option value="{{ key }}">{{ val }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è</label>
                    <select name="target_audience" class="form-input">
                        {% for key, val in audiences.items() %}
                        <option value="{{ key }}">{{ val }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <!-- –ê–¥—Ä–µ—Å -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–ê–î–†–ï–°</h4>
            <div class="form-group">
                <label class="form-label">–ì–æ—Ä–æ–¥</label>
                <input type="text" name="city" class="form-input" placeholder="–ú–æ—Å–∫–≤–∞">
            </div>
            <div class="form-group">
                <label class="form-label">–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å</label>
                <input type="text" name="address" class="form-input" placeholder="—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 1">
            </div>
            
            <!-- –Æ—Ä. –ª–∏—Ü–æ -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–Æ–†–ò–î–ò–ß–ï–°–ö–û–ï –õ–ò–¶–û</h4>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</label>
                <input type="text" name="legal_name" class="form-input" placeholder="–û–û–û ¬´–†–∞—Å—Å–≤–µ—Ç¬ª">
            </div>
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">–ò–ù–ù</label>
                    <input type="text" name="inn" class="form-input" placeholder="1234567890" maxlength="12">
                </div>
                <div class="form-group">
                    <label class="form-label">% –≤—ã–ø–ª–∞—Ç—ã –ø–ª–æ—â–∞–¥–∫–µ</label>
                    <input type="number" name="revenue_share" class="form-input" value="30" min="0" max="100" step="1">
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–ö–û–ù–¢–ê–ö–¢–´</h4>
            <div class="form-group">
                <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                <input type="text" name="contact_person" class="form-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
            </div>
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" name="contact_phone" class="form-input" placeholder="+7 999 123-45-67">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="contact_email" class="form-input" placeholder="contact@venue.ru">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea name="description" class="form-input" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¢–í..."></textarea>
            </div>
            
            <!-- –§–æ—Ç–æ —ç–∫—Ä–∞–Ω–∞ -->
            <h4 style="margin: 1rem 0 0.75rem; color: var(--text-muted); font-size: 0.875rem;">–§–û–¢–û –≠–ö–†–ê–ù–ê</h4>
            <div class="form-group">
                <label class="form-label">URL —Ñ–æ—Ç–æ —ç–∫—Ä–∞–Ω–∞</label>
                <input type="url" name="photo_url" class="form-input" placeholder="https://example.com/tv-photo.jpg">
                <small style="color: var(--text-muted);">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ –¢–í-—ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∏–∂–µ</small>
            </div>
            <div class="form-group">
                <label class="form-label">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</label>
                <input type="file" name="photo_file" accept="image/*" class="form-input">
                <small style="color: var(--text-muted);">JPG, PNG, –¥–æ 5 –ú–ë</small>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –¢–í</button>
                <button type="button" onclick="document.getElementById('addTvModal').style.display='none'" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
