{% extends "base.html" %}

{% block title %}–ö–∞–±–∏–Ω–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ ‚Äî XK Media{% endblock %}

{% block logo %}
<a href="/venue" class="logo">
    <span class="logo-icon">üì∫</span>
    XK Media
</a>
{% endblock %}

{% block nav %}
<a href="/venue" class="active">–û–±–∑–æ—Ä</a>
<a href="/venue/tvs">–ú–æ–∏ –¢–í</a>
<a href="/venue/earnings">–î–æ—Ö–æ–¥—ã</a>
<a href="/venue/profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
<a href="/logout" class="btn btn-secondary btn-sm">–í—ã–π—Ç–∏</a>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div>
        <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.company_name or user.first_name or user.email }}</h1>
        <p class="subtitle">–ö–∞–±–∏–Ω–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–ª–æ—â–∞–¥–∫–∏</p>
    </div>
    <a href="/venue/tv/add" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –¢–í</a>
</div>

<nav class="tabs">
    <a href="/venue" class="tab active">–û–±–∑–æ—Ä</a>
    <a href="/venue/tvs" class="tab">–ú–æ–∏ –¢–í</a>
    <a href="/venue/advertisers" class="tab">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–∏</a>
    <a href="/venue/earnings" class="tab">–î–æ—Ö–æ–¥—ã</a>
    <a href="/venue/documents" class="tab">–î–æ–∫—É–º–µ–Ω—Ç—ã</a>
    <a href="/venue/profile" class="tab">–ü—Ä–æ—Ñ–∏–ª—å</a>
</nav>

<!-- Stats Cards -->
<div class="grid grid-4">
    <div class="card stat-card">
        <div class="stat-icon">üì∫</div>
        <div class="stat-value">{{ stats.total_tvs }}</div>
        <div class="stat-label">–¢–í-—ç–∫—Ä–∞–Ω–æ–≤</div>
        <div class="stat-sub">–ê–∫—Ç–∏–≤–Ω—ã—Ö: {{ stats.active_tvs }}</div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon">üëÅÔ∏è</div>
        <div class="stat-value">{{ "{:,}".format(stats.total_impressions).replace(",", " ") }}</div>
        <div class="stat-label">–ü–æ–∫–∞–∑–æ–≤ —Ä–µ–∫–ª–∞–º—ã</div>
        <div class="stat-sub">–ü–µ—Ä–µ—Ö–æ–¥–æ–≤: {{ stats.total_clicks }}</div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-value">{{ stats.total_earnings }} ‚ÇΩ</div>
        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
        <div class="stat-sub">–í—ã–ø–ª–∞—á–µ–Ω–æ: {{ stats.total_paid }} ‚ÇΩ</div>
    </div>
    <div class="card stat-card highlight">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-value">{{ stats.pending }} ‚ÇΩ</div>
        <div class="stat-label">–ö –≤—ã–ø–ª–∞—Ç–µ</div>
        <div class="stat-sub">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π: {{ stats.advertisers_count }}</div>
    </div>
</div>

<!-- Main Content -->
<div class="grid grid-2">
    <!-- TVs List -->
    <div class="card">
        <div class="card-header">
            <h3>üì∫ –ú–æ–∏ –¢–í-—ç–∫—Ä–∞–Ω—ã</h3>
            <a href="/venue/tvs" class="btn btn-sm">–í—Å–µ ‚Üí</a>
        </div>
        <div class="card-content">
            {% if tvs %}
            <div class="list">
                {% for tv in tvs[:5] %}
                <a href="/venue/tv/{{ tv.id }}" class="list-item">
                    <div class="list-item-main">
                        <div class="list-item-title">{{ tv.name }}</div>
                        <div class="list-item-sub">{{ tv.venue_name or tv.address or "‚Äî" }}</div>
                    </div>
                    <div class="list-item-badge {{ 'badge-success' if tv.is_approved else 'badge-warning' }}">
                        {{ "–ê–∫—Ç–∏–≤–µ–Ω" if tv.is_approved else "–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏" }}
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üì∫</div>
                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¢–í-—ç–∫—Ä–∞–Ω–æ–≤</p>
                <a href="/venue/tv/add" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –¢–í</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Tariff Info -->
    <div class="card">
        <div class="card-header">
            <h3>üíé –¢–∞—Ä–∏—Ñ—ã</h3>
        </div>
        <div class="card-content">
            <div class="tariff-cards">
                <div class="tariff-card">
                    <div class="tariff-icon">üñ•Ô∏è</div>
                    <div class="tariff-title">–¢–í –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞</div>
                    <div class="tariff-percent">60%</div>
                    <div class="tariff-desc">–í–∞–º –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è 60% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è XK Media</div>
                </div>
                <div class="tariff-card highlight">
                    <div class="tariff-icon">üì∫</div>
                    <div class="tariff-title">–°–≤–æ—ë –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                    <div class="tariff-percent">70%</div>
                    <div class="tariff-desc">–í–∞–º –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è 70% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤–∞—à–µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Payouts -->
<div class="card">
    <div class="card-header">
        <h3>üí∏ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã</h3>
        <a href="/venue/earnings" class="btn btn-sm">–í—Å–µ –≤—ã–ø–ª–∞—Ç—ã ‚Üí</a>
    </div>
    <div class="card-content">
        {% if recent_payouts %}
        <table class="table">
            <thead>
                <tr>
                    <th>–ü–µ—Ä–∏–æ–¥</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for payout in recent_payouts %}
                <tr>
                    <td>{{ payout.period_start.strftime("%d.%m") }} ‚Äî {{ payout.period_end.strftime("%d.%m.%Y") }}</td>
                    <td class="amount">{{ "{:,.0f}".format(payout.amount).replace(",", " ") }} ‚ÇΩ</td>
                    <td>
                        {% if payout.status == "paid" %}
                        <span class="badge badge-success">–í—ã–ø–ª–∞—á–µ–Ω–æ</span>
                        {% elif payout.status == "processing" %}
                        <span class="badge badge-warning">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</span>
                        {% else %}
                        <span class="badge badge-info">–û–∂–∏–¥–∞–µ—Ç</span>
                        {% endif %}
                    </td>
                    <td>{{ payout.paid_at.strftime("%d.%m.%Y") if payout.paid_at else "‚Äî" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state-small">
            <p>–í—ã–ø–ª–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º—ã –Ω–∞ –≤–∞—à–∏—Ö –¢–í.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.tariff-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.tariff-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.2s;
}

.tariff-card.highlight {
    border-color: var(--accent);
    background: rgba(233, 69, 96, 0.05);
}

.tariff-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.tariff-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.tariff-percent {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
}

.tariff-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

@media (max-width: 768px) {
    .tariff-cards {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
