{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî {{ tv.name }}{% endblock %}

{% block logo %}
<a href="/admin" class="logo">
    <span class="logo-icon">üì∫</span>
    XK Media
</a>
{% endblock %}

{% block nav %}
<a href="/admin">–î–∞—à–±–æ—Ä–¥</a>
<a href="/admin/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
<a href="/admin/tvs" class="active">–≠–∫—Ä–∞–Ω—ã</a>
<a href="/admin/payments">–ü–ª–∞—Ç–µ–∂–∏</a>
<a href="/admin/payouts">–í—ã–ø–ª–∞—Ç—ã</a>
<a href="/admin/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
<a href="/logout" class="btn btn-secondary btn-sm">–í—ã–π—Ç–∏</a>
{% endblock %}

{% block content %}
<div class="page-header">
    <a href="/admin/tv/{{ tv.code }}/advertisers" style="color: var(--text-muted); font-size: 0.875rem;">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º</a>
    <h1 class="page-title" style="margin-top: 0.5rem;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã</h1>
    <p class="page-subtitle">
        {{ tv.name }} ¬∑ {{ link.title }}
    </p>
</div>

<form method="POST" action="/admin/tv/{{ tv.code }}/advertisers/{{ link.id }}/edit">
    <div class="grid grid-2">
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìã –î–∞–Ω–Ω—ã–µ —Ä–µ–∫–ª–∞–º—ã</h3>
            </div>
            
            <div class="form-group">
                <label class="form-label">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—å</label>
                <select name="advertiser_id" class="form-input">
                    {% for a in all_advertisers %}
                    <option value="{{ a.id }}" {% if a.id == link.advertiser_id %}selected{% endif %}>
                        {{ a.company_name or a.first_name or a.email }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                <input type="text" name="title" value="{{ link.title }}" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">URL —Å—Å—ã–ª–∫–∏ *</label>
                <input type="url" name="url" value="{{ link.url }}" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea name="description" class="form-input" rows="3">{{ link.description or '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">URL –∫–∞—Ä—Ç–∏–Ω–∫–∏</label>
                <input type="url" name="image_url" value="{{ link.image_url or '' }}" class="form-input" placeholder="https://example.com/banner.jpg">
            </div>
            
            {% if link.image_url %}
            <div style="margin-bottom: 1rem;">
                <img src="{{ link.image_url }}" alt="{{ link.title }}" style="max-width: 100%; max-height: 150px; border-radius: 8px; object-fit: cover;">
            </div>
            {% endif %}
            
            <div class="form-group">
                <label class="form-label">–ü–æ–∑–∏—Ü–∏—è (–ø–æ—Ä—è–¥–æ–∫)</label>
                <input type="number" name="position" value="{{ link.position }}" class="form-input" min="0">
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="is_active" {% if link.is_active %}checked{% endif %}>
                    <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                </label>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            </div>
            
            <div class="grid grid-2" style="margin-bottom: 1.5rem;">
                <div class="stat-card" style="background: var(--secondary); border-radius: 12px; padding: 1.5rem;">
                    <div class="stat-value" style="color: var(--accent);">{{ link.impressions or 0 }}</div>
                    <div class="stat-label">–ü–æ–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card" style="background: var(--secondary); border-radius: 12px; padding: 1.5rem;">
                    <div class="stat-value" style="color: var(--success);">{{ link.clicks or 0 }}</div>
                    <div class="stat-label">–ö–ª–∏–∫–æ–≤</div>
                </div>
            </div>
            
            <div style="background: var(--secondary); border-radius: 12px; padding: 1.5rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700;">
                    {% if link.impressions and link.impressions > 0 %}
                    {{ "%.2f"|format(link.clicks / link.impressions * 100) }}%
                    {% else %}
                    0%
                    {% endif %}
                </div>
                <div style="color: var(--text-muted);">CTR (Click-Through Rate)</div>
            </div>
            
            <hr style="border: none; border-top: 1px solid var(--border); margin: 1.5rem 0;">
            
            <div style="color: var(--text-muted); font-size: 0.875rem;">
                <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ link.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                {% if link.updated_at %}
                <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> {{ link.updated_at.strftime('%d.%m.%Y %H:%M') }}</p>
                {% endif %}
            </div>
            
            <hr style="border: none; border-top: 1px solid var(--border); margin: 1.5rem 0;">
            
            <!-- –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) -->
            <h4 style="margin-bottom: 1rem; color: var(--text-muted);">üîß –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–µ—Å—Ç)</h4>
            <div class="grid grid-2">
                <div class="form-group" style="margin: 0;">
                    <label class="form-label">–ü–æ–∫–∞–∑—ã</label>
                    <input type="number" name="impressions" value="{{ link.impressions or 0 }}" class="form-input" min="0">
                </div>
                <div class="form-group" style="margin: 0;">
                    <label class="form-label">–ö–ª–∏–∫–∏</label>
                    <input type="number" name="clicks" value="{{ link.clicks or 0 }}" class="form-input" min="0">
                </div>
            </div>
            <small style="color: var(--text-muted);">–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ API –ø–ª–µ–µ—Ä–∞</small>
        </div>
    </div>
    
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
        <button type="submit" class="btn btn-primary btn-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        <a href="/admin/tv/{{ tv.code }}/advertisers" class="btn btn-secondary btn-lg">–û—Ç–º–µ–Ω–∞</a>
        <div style="flex: 1;"></div>
        <a href="/admin/tv/{{ tv.code }}/advertisers/{{ link.id }}/delete" class="btn btn-secondary btn-lg" style="color: var(--accent);"
           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–µ–∫–ª–∞–º—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    </div>
</form>
{% endblock %}
