{% extends "base.html" %}

{% block title %}Вход — XK Media{% endblock %}

{% block head %}
<style>
    .auth-container {
        max-width: 420px;
        margin: 2rem auto;
    }

    .auth-card {
        padding: 2.5rem;
    }

    .auth-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .auth-header h1 {
        font-size: 1.75rem;
        margin-bottom: 0.5rem;
    }

    .auth-header p {
        color: var(--text-muted);
    }

    .auth-form {
        margin-bottom: 1.5rem;
    }

    .auth-footer {
        text-align: center;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border);
        color: var(--text-muted);
    }

    .divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
        color: var(--text-muted);
    }

    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: var(--border);
    }

    .divider span {
        padding: 0 1rem;
        font-size: 0.875rem;
    }

    .forgot-link {
        display: block;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: var(--accent);
        text-decoration: none;
    }

    .forgot-link:hover {
        text-decoration: underline;
    }

    .oauth-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .oauth-buttons .btn {
        background: var(--card-bg);
        border: 1px solid var(--border);
        color: var(--text);
        transition: all 0.3s;
    }

    .oauth-buttons .btn:hover {
        background: var(--card-bg-hover);
        border-color: var(--border-hover);
        transform: translateY(-2px);
    }

    .oauth-buttons .btn svg {
        flex-shrink: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="card auth-card">
        <div class="auth-header">
            <h1>Вход в систему</h1>
            <p>Войдите в свой аккаунт XK Media</p>
        </div>

        {% if error %}
        <div class="alert alert-error">{{ error }}</div>
        {% endif %}

        {% if request.query_params.get('error') == 'oauth_invalid' %}
        <div class="alert alert-error">❌ Ошибка авторизации: неверный запрос. Попробуйте еще раз.</div>
        {% elif request.query_params.get('error') == 'oauth_failed' %}
        <div class="alert alert-error">❌ Ошибка авторизации: не удалось получить доступ. Проверьте настройки OAuth.</div>
        {% elif request.query_params.get('error') == 'oauth_no_email' %}
        <div class="alert alert-error">❌ Ошибка авторизации: не удалось получить email. Убедитесь, что вы предоставили доступ к email.</div>
        {% elif request.query_params.get('error') == 'oauth_not_configured' %}
        <div class="alert alert-error">⚠️ OAuth не настроен. Обратитесь к администратору.</div>
        {% elif request.query_params.get('error') == 'oauth_config_error' %}
        <div class="alert alert-error">❌ Ошибка конфигурации OAuth. Обратитесь к администратору.</div>
        {% endif %}

        {% if request.query_params.get('success') == 'password_reset' %}
        <div class="alert alert-success">✓ Пароль успешно изменён. Войдите с новым паролем.</div>
        {% endif %}

        <form class="auth-form" method="POST" action="/login">
            <div class="form-group">
                <label class="form-label" for="email">Email</label>
                <input type="email" id="email" name="email" class="form-input" placeholder="your@email.com" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="password">Пароль</label>
                <input type="password" id="password" name="password" class="form-input" placeholder="••••••••" required>
                <a href="/forgot-password" class="forgot-link">Забыли пароль?</a>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%;">Войти</button>
        </form>

        <div class="divider"><span>или</span></div>

        <div class="oauth-buttons" style="margin-bottom: 1.5rem;">
            <a href="/auth/oauth/google" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Войти через Google
            </a>
            <a href="/auth/oauth/yandex" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#FC3F1D" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 16.894H8.106v-1.789h9.788v1.789zm0-3.577H8.106v-1.789h9.788v1.789zm0-3.577H8.106V7.95h9.788v1.79z"/></svg>
                Войти через Yandex
            </a>
            <a href="/auth/oauth/vk" class="btn btn-secondary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#0077FF"><path d="M12.785 15.639s.336-.041.509-.249c.16-.193.16-.558.16-.558s-.023-1.574.72-1.806c.734-.225 1.675 1.51 2.67 2.175.748.501 1.313.374 1.313.374l2.67-.037s1.395-.09.733-1.19c-.054-.082-.386-.8-1.98-2.26-1.675-1.54-1.45-1.29.567-3.953 1.24-1.64 1.736-2.64 1.582-3.068-.146-.41-1.05-.302-1.05-.302l-3.003.018s-.223-.03-.388.07c-.16.099-.262.33-.262.33s-.47 1.25-1.095 2.31c-1.32 2.35-1.85 2.48-2.067 2.33-.505-.35-.379-1.41-.379-2.16 0-2.35.35-3.33-.686-3.58-.345-.083-.599-.138-1.482-.147-1.135-.01-1.872.003-2.357.24-.325.16-.576.52-.423.54.192.022.627.12.856.44.297.414.286 1.34.286 1.34s.17 2.5-.396 2.81c-.389.21-.925-.22-2.075-2.33-.59-1.05-1.04-2.21-1.04-2.21s-.087-.21-.244-.32c-.19-.13-.458-.17-.458-.17l-2.86.018s-.48.014-.657.22c-.16.186-.012.57-.012.57s2.24 5.25 4.77 7.9c2.32 2.36 4.96 2.21 4.96 2.21h1.19s.36.024.55-.18c.17-.19.17-.45.17-.45s-.02-1.28.67-1.47c.68-.19 1.55 1.29 2.47 1.86.68.42 1.2.33 1.2.33l2.47-.03s1.29-.08.68-1.05c-.05-.08-.4-.62-1.62-1.76-1.37-1.3-1.16-1.09.45-3.34.97-1.35 1.36-2.17 1.24-2.52-.11-.33-.79-.24-.79-.24l-2.73.02s-.2-.01-.35.05c-.13.05-.22.16-.22.16s-.04.03-.07.09l.07-.09s-.36.87-.83 1.61z"/></svg>
                Войти через VK
            </a>
        </div>

        <div class="auth-footer">
            <p>Нет аккаунта? <a href="/register">Зарегистрироваться</a></p>
        </div>
    </div>
</div>
{% endblock %}


