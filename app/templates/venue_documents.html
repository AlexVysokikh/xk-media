{% extends "base.html" %}

{% block title %}–ó–∞–∫—Ä—ã–≤–∞—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî XK Media{% endblock %}

{% block logo %}
<a href="/venue" class="logo">
    <span class="logo-icon">üì∫</span>
    XK Media
</a>
{% endblock %}

{% block nav %}
<a href="/venue">–û–±–∑–æ—Ä</a>
<a href="/venue/tvs">–ú–æ–∏ –¢–í</a>
<a href="/venue/earnings">–î–æ—Ö–æ–¥—ã</a>
<a href="/venue/profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
<a href="/logout" class="btn btn-secondary btn-sm">–í—ã–π—Ç–∏</a>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div>
        <h1>üìÑ –ó–∞–∫—Ä—ã–≤–∞—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h1>
        <p class="subtitle">–ê–∫—Ç—ã, —Å—á–µ—Ç–∞ –∏ –æ—Ç—á—ë—Ç—ã</p>
    </div>
</div>

<nav class="tabs">
    <a href="/venue" class="tab">–û–±–∑–æ—Ä</a>
    <a href="/venue/tvs" class="tab">–ú–æ–∏ –¢–í</a>
    <a href="/venue/advertisers" class="tab">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–∏</a>
    <a href="/venue/earnings" class="tab">–î–æ—Ö–æ–¥—ã</a>
    <a href="/venue/documents" class="tab active">–î–æ–∫—É–º–µ–Ω—Ç—ã</a>
    <a href="/venue/profile" class="tab">–ü—Ä–æ—Ñ–∏–ª—å</a>
</nav>

<!-- Stats -->
<div class="grid grid-3">
    <div class="card stat-card">
        <div class="stat-icon">üìÑ</div>
        <div class="stat-value">{{ documents | length }}</div>
        <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
    </div>
    <div class="card stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-value">{{ pending_docs | length }}</div>
        <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è</div>
    </div>
    <div class="card stat-card highlight">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-value">{{ total_amount }} ‚ÇΩ</div>
        <div class="stat-label">–°—É–º–º–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö</div>
    </div>
</div>

<div class="grid grid-2">
    <!-- Request Document -->
    <div class="card">
        <div class="card-header">
            <h3>üìù –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h3>
        </div>
        <div class="card-content">
            <form method="POST" action="/venue/documents/request">
                <div class="form-group">
                    <label for="document_type">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
                    <select id="document_type" name="document_type">
                        {% for key, value in document_types.items() %}
                        <option value="{{ key }}">{{ value }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                {% if payouts %}
                <div class="form-group">
                    <label for="payout_id">–°–≤—è–∑–∞–Ω–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <select id="payout_id" name="payout_id">
                        <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî</option>
                        {% for payout in payouts %}
                        <option value="{{ payout.id }}">
                            {{ payout.period_start.strftime("%d.%m") }} ‚Äî {{ payout.period_end.strftime("%d.%m.%Y") }} 
                            ({{ "{:,.0f}".format(payout.amount).replace(",", " ") }} ‚ÇΩ)
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                
                <button type="submit" class="btn btn-primary">üìÑ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
            </form>
            
            <div class="info-block">
                <h4>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                <p>–î–æ–∫—É–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–ø–ª–∞—Ç–∞—Ö. –ü–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.</p>
            </div>
        </div>
    </div>

    <!-- Document Types Info -->
    <div class="card">
        <div class="card-header">
            <h3>üìã –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h3>
        </div>
        <div class="card-content">
            <div class="doc-types-list">
                <div class="doc-type-item">
                    <div class="doc-type-icon">üìú</div>
                    <div class="doc-type-info">
                        <div class="doc-type-title">–ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</div>
                        <div class="doc-type-desc">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é —Ä–µ–∫–ª–∞–º—ã</div>
                    </div>
                </div>
                <div class="doc-type-item">
                    <div class="doc-type-icon">üí≥</div>
                    <div class="doc-type-info">
                        <div class="doc-type-title">–°—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É</div>
                        <div class="doc-type-desc">–î–ª—è –æ–ø–ª–∞—Ç—ã —É—Å–ª—É–≥ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)</div>
                    </div>
                </div>
                <div class="doc-type-item">
                    <div class="doc-type-icon">üìä</div>
                    <div class="doc-type-info">
                        <div class="doc-type-title">–û—Ç—á—ë—Ç –æ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏</div>
                        <div class="doc-type-desc">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</div>
                    </div>
                </div>
                <div class="doc-type-item">
                    <div class="doc-type-icon">üìù</div>
                    <div class="doc-type-info">
                        <div class="doc-type-title">–î–æ–≥–æ–≤–æ—Ä</div>
                        <div class="doc-type-desc">–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Documents Table -->
<div class="card">
    <div class="card-header">
        <h3>üìÇ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h3>
    </div>
    <div class="card-content">
        {% if documents %}
        <table class="table">
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–¢–∏–ø</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ü–µ—Ä–∏–æ–¥</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                <tr>
                    <td><strong>{{ doc.number or "‚Äî" }}</strong></td>
                    <td>{{ document_types.get(doc.document_type, doc.document_type) }}</td>
                    <td>{{ doc.title }}</td>
                    <td>
                        {% if doc.period_start and doc.period_end %}
                        {{ doc.period_start.strftime("%d.%m") }} ‚Äî {{ doc.period_end.strftime("%d.%m.%Y") }}
                        {% else %}
                        ‚Äî
                        {% endif %}
                    </td>
                    <td>{{ "{:,.0f}".format(doc.amount or 0).replace(",", " ") }} ‚ÇΩ</td>
                    <td>
                        {% if doc.status == "signed" %}
                        <span class="badge badge-success">–ü–æ–¥–ø–∏—Å–∞–Ω</span>
                        {% elif doc.status == "sent" %}
                        <span class="badge badge-warning">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</span>
                        {% else %}
                        <span class="badge badge-info">–°–æ–∑–¥–∞–Ω</span>
                        {% endif %}
                    </td>
                    <td>{{ doc.created_at.strftime("%d.%m.%Y") }}</td>
                    <td>
                        {% if doc.file_url %}
                        <a href="{{ doc.file_url }}" class="btn btn-sm" target="_blank">üì• –°–∫–∞—á–∞—Ç—å</a>
                        {% else %}
                        <span class="text-secondary">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìÑ</div>
            <p>–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
            <p class="text-secondary">–ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –≤—ã—à–µ</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.info-block {
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    border-left: 3px solid var(--accent);
}

.info-block h4 {
    margin-bottom: 0.5rem;
}

.info-block p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

.doc-types-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.doc-type-item {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 8px;
}

.doc-type-icon {
    font-size: 1.5rem;
}

.doc-type-info {
    flex: 1;
}

.doc-type-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.doc-type-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
}
</style>
{% endblock %}
